import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import matplotlib.font_manager as fm
import seaborn as sb
import os

# ë¡œì»¬ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  í°íŠ¸ (Mac ê¸°ì¤€)
if os.name == 'posix':  # Mac í™˜ê²½ì—ì„œ
    plt.rcParams['font.family'] = 'AppleGothic'  # Mac ê¸°ë³¸ í•œê¸€ í°íŠ¸
else:
    plt.rcParams['font.family'] = 'NanumGothic'  # ë°°í¬ í™˜ê²½ì—ì„œ ì‚¬ìš©ë  í•œê¸€ í°íŠ¸

plt.rcParams['axes.unicode_minus'] = False  # ë§ˆì´ë„ˆìŠ¤ ê¸°í˜¸ ê¹¨ì§ ë°©ì§€

# ë°ì´í„° ë¡œë“œ
df = pd.read_csv("data/ê³ ê°db_ì „ì²˜ë¦¬.csv")

# ë‚ ì§œ ë°ì´í„° ë³€í™˜
df["ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ"] = pd.to_datetime(df["ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ"])

# Streamlit í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ê³ ê° ë¶„ì„ ëŒ€ì‹œë³´ë“œ", layout="wide")

# í˜ì´ì§€ ì œëª©
st.title("ë¶„ì„ ëŒ€ì‹œë³´ë“œ")

tab1, tab2 = st.tabs(["ê³ ê° ë°ì´í„° ë¶„ì„", "íŒë§¤ ë°ì´í„° ë¶„ì„"])

with tab1 :
    # ê³ ê° ë°ì´í„° ë¶„ì„ ì„¹ì…˜
    st.header("ê³ ê° ë°ì´í„° ë¶„ì„")
    st.write("ê³ ê° ë°ì´í„° ê¸°ë°˜ì˜ ë¶„ì„ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.")

    # ë¶„ì„ ê°œìš” ì„¹ì…˜
    with st.expander("ë¶„ì„ ê°œìš” ë³´ê¸°"):
        st.write("""
        **í”„ë¡œì íŠ¸ ëª©í‘œ**  
        - ê³ ê°ì˜ ì—°ë ¹ëŒ€, ê±°ì£¼ ì§€ì—­, êµ¬ë§¤ ì„ í˜¸ë„ë¥¼ ë¶„ì„í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ ì œê³µ  
        - ì „ê¸°ì°¨ ë° ë‚´ì—°ê¸°ê´€ì°¨ì˜ íŠ¸ë Œë“œ ë³€í™” í™•ì¸  
        - ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ë§ˆì¼€íŒ… ì „ëµ ìµœì í™”  

        **ì‚¬ìš©ëœ ë°ì´í„°**  
        - ê³ ê° ì—°ë ¹ëŒ€, ê±°ì£¼ ì§€ì—­, ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸, ì—°ë£Œ ìœ í˜•, ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ ë“±  
        """)

    st.text("")

    # ì—°ë ¹ëŒ€ ì •ë ¬ì„ ìœ„í•œ ìˆœì„œ ì§€ì •
    age_order = [
        "20ëŒ€ ì´ˆë°˜", "20ëŒ€ ì¤‘ë°˜", "20ëŒ€ í›„ë°˜",
        "30ëŒ€ ì´ˆë°˜", "30ëŒ€ ì¤‘ë°˜", "30ëŒ€ í›„ë°˜",
        "40ëŒ€ ì´ˆë°˜", "40ëŒ€ ì¤‘ë°˜", "40ëŒ€ í›„ë°˜",
        "50ëŒ€ ì´ˆë°˜", "50ëŒ€ ì¤‘ë°˜", "50ëŒ€ í›„ë°˜",
        "60ëŒ€ ì´ˆë°˜", "60ëŒ€ ì¤‘ë°˜", "60ëŒ€ í›„ë°˜",
        "70ëŒ€ ì´ˆë°˜"
    ]

    col1, col2 = st.columns([0.9, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- ì—°ë ¹ëŒ€ë³„ ê³ ê° ë¶„í¬ ----
        st.subheader("ì—°ë ¹ëŒ€ë³„ ê³ ê° ë¶„í¬")
        st.write("ê³ ê°ì˜ ì—°ë ¹ëŒ€ë³„ ë¶„í¬ë¥¼ íˆìŠ¤í† ê·¸ë¨ìœ¼ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")  

        # ì—°ë ¹ëŒ€ ì •ë ¬ í›„ ì‹œê°í™”
        df["ì—°ë ¹ëŒ€"] = pd.Categorical(df["ì—°ë ¹ëŒ€"], categories=age_order, ordered=True)
        fig1, ax = plt.subplots(figsize=(8, 5))
        sns.histplot(df.sort_values("ì—°ë ¹ëŒ€")["ì—°ë ¹ëŒ€"], kde=True, color="blue", ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("ì—°ë ¹ëŒ€")
        ax.set_ylabel("ê³ ê° ìˆ˜")
        st.pyplot(fig1)

        st.markdown("""
        **ğŸ“Š ë¶„ì„ ê²°ê³¼ **  
        - **20ëŒ€ ì¤‘ë°˜**: ì‚¬íšŒ ì´ˆë…„ìƒìœ¼ë¡œ ì´ë™ ìˆ˜ë‹¨ì˜ í•„ìš”ì„±ì´ ì¦ê°€í•˜ë©° ì°¨ëŸ‰ êµ¬ë§¤ ê³ ë ¤  
        - **30ëŒ€ í›„ë°˜~40ëŒ€**: ê²°í˜¼ ë° ìë…€ ì¶œì‚°ê³¼ ë§ë¬¼ë ¤ ê°€ì¡± ì°¨ëŸ‰ìœ¼ë¡œ êµì²´ ìˆ˜ìš” ì¦ê°€  
        - **ê²½ì œì  ë¶€ë‹´**: ì£¼ê±°ë¹„, ìœ¡ì•„ë¹„ ì¦ê°€ë¡œ ì¸í•´ ì¼ë¶€ ì†Œë¹„ìëŠ” ì°¨ëŸ‰ êµ¬ë§¤ë¥¼ ë¯¸ë£¨ëŠ” ê²½í–¥  

        ì°¸ê³  ìë£Œ ì¶œì²˜ : [ì—°í•©ë‰´ìŠ¤](https://www.yna.co.kr/view/AKR20241014066100530)
        """)
    with col2:
        # ---- ì§€ì—­ë³„ ê³ ê° ìˆ˜ ë¶„ì„ ----
        st.subheader("ì§€ì—­ë³„ ê³ ê° ë¶„í¬")
        st.write("ê³ ê°ë“¤ì´ ê±°ì£¼í•˜ëŠ” ì§€ì—­ë³„ ë¶„í¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.") 

        fig2, ax = plt.subplots(figsize=(8, 5))
        df["ê±°ì£¼ ì§€ì—­"].value_counts().plot(kind="barh", color="orange", ax=ax)
        ax.set_xlabel("ì§€ì—­")
        ax.set_ylabel("ê³ ê° ìˆ˜") 
        st.pyplot(fig2)
        st.text("")
        st.text("")
        st.markdown("""
        **íšŒì›ê°€ì… ë¶„ì„ ê²°ê³¼**  
        - ì„œìš¸Â·ê²½ê¸° ì§€ì—­ì— íšŒì›ì´ ì§‘ì¤‘ë¨ â†’ ìˆ˜ë„ê¶Œ ì¤‘ì‹¬ì˜ ì°¨ëŸ‰ êµ¬ë§¤ ë° ì„œë¹„ìŠ¤ ìˆ˜ìš”ê°€ ë†’ìŒ.
        - ì§€ë°© ê±°ì£¼ íšŒì› ë¹„ì¤‘ì´ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ìŒ â†’ ë¹„ëŒ€ë©´ ì„œë¹„ìŠ¤ ë° ì˜¨ë¼ì¸ ê³„ì•½ í™•ëŒ€ í•„ìš”.
        - ëŒ€ë„ì‹œ(ê´‘ì£¼, ë¶€ì‚°, ëŒ€êµ¬)ë„ ê°€ì…ì ë¹„ìœ¨ì´ ë†’ìŒ â†’ í•´ë‹¹ ì§€ì—­ì—ì„œ ë§ì¶¤í˜• ë§ˆì¼€íŒ… ë° ì‹œìŠ¹ í–‰ì‚¬ ê¸°íš ê°€ëŠ¥.
                    
        ì°¸ê³  ìë£Œ ì¶œì²˜ : KATECH Insight, ì¸êµ¬ ì‚¬íšŒêµ¬ì¡° ë³€í™”ì™€ êµ­ë‚´ ìë™ì°¨ ì‹œì¥ Â· ì„í˜„ì§„ ì„ ì„ì—°êµ¬ì›
        """)

    st.markdown("---")
    
    # ì—°ë ¹ëŒ€ë³„ ìƒìœ„ 3ê°œ ì°¨ëŸ‰ ëª¨ë¸ ì„ ì •
    top_models = df.groupby(["ì—°ë ¹ëŒ€", "ìµœê·¼ êµ¬ë§¤ ì œí’ˆ"]).size().reset_index(name="count")
    top_models = top_models.sort_values(["ì—°ë ¹ëŒ€", "count"], ascending=[True, False])
    top_models = top_models.groupby("ì—°ë ¹ëŒ€").head(3)  # ê° ì—°ë ¹ëŒ€ì—ì„œ ìƒìœ„ 3ê°œ ëª¨ë¸ ì„ íƒ

    eco_friendly_types = ["ì „ê¸°", "ìˆ˜ì†Œ", "í•˜ì´ë¸Œë¦¬ë“œ", "í”ŒëŸ¬ê·¸ì¸í•˜ì´ë¸Œë¦¬ë“œ"]
    ev_preference = df[df["ì—°ë£Œ êµ¬ë¶„"].isin(eco_friendly_types)].groupby("ì—°ë ¹ëŒ€")["ì—°ë£Œ êµ¬ë¶„"].count()

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- ì°¨ëŸ‰ ë¸Œëœë“œ & ëª¨ë¸ë³„ ì„ í˜¸ë„ ë¶„ì„ ----
        st.subheader("ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ ë¶„ì„")
        st.write("ì—°ë ¹ëŒ€ë³„ë¡œ ì„ í˜¸í•˜ëŠ” ìƒìœ„ 3ê°œ ì°¨ëŸ‰ ëª¨ë¸ì„ ì„ ì •í•˜ì—¬ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤.")

        fig1, ax = plt.subplots(figsize=(10, 6))
        sns.barplot(data=top_models, x="ì—°ë ¹ëŒ€", y="count", hue="ìµœê·¼ êµ¬ë§¤ ì œí’ˆ", palette="coolwarm", ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("ì—°ë ¹ëŒ€")
        ax.set_ylabel("ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ ìˆ˜")
        ax.set_title("ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ (ìƒìœ„ 3ê°œ)")
        st.pyplot(fig1)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
        - 20~30ëŒ€ëŠ” ì†Œí˜• ë° ìŠ¤í¬ì¸ ì¹´ ì„ í˜¸, 40ëŒ€ ì´ìƒì€ SUV ë° ì„¸ë‹¨ ì„ í˜¸  
        - ì Šì€ ê³ ê°ì¸µ ëŒ€ìƒ, ìŠ¤í¬í‹°í•œ ë””ìì¸ê³¼ ìµœì‹  ê¸°ìˆ  ê°•ì¡°  
        - 40ëŒ€ ì´ìƒ ê³ ê° ëŒ€ìƒ, ê°€ì¡±ìš© SUV ë° í•˜ì´ë¸Œë¦¬ë“œ ì°¨ëŸ‰ í”„ë¡œëª¨ì…˜ ê°•í™”
        """)
    with col2:
        # ---- ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ ì„ í˜¸ë„ ë¶„ì„ ----
        st.subheader("ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ ì„ í˜¸ë„")
        st.write("ê° ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰(ì „ê¸°, ìˆ˜ì†Œ, í•˜ì´ë¸Œë¦¬ë“œ, í”ŒëŸ¬ê·¸ì¸í•˜ì´ë¸Œë¦¬ë“œ)ì˜ ì„ í˜¸ë„ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.")   

        fig2, ax = plt.subplots(figsize=(8, 5))
        ev_preference.plot(kind="bar", color="lightgreen", ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("ì—°ë ¹ëŒ€")
        ax.set_ylabel("ì¹œí™˜ê²½ ì°¨ëŸ‰ êµ¬ë§¤ ìˆ˜")
        ax.set_title("ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ êµ¬ë§¤ ì„ í˜¸ë„")
        st.pyplot(fig2)
    
        st.markdown("""
        **ì¹œí™˜ê²½ ì°¨ëŸ‰ êµ¬ë§¤ ì—°ë ¹ì¸µ ë¶„ì„ ê²°ê³¼**  
        - **30~50ëŒ€**ê°€ ì¹œí™˜ê²½ ì°¨ëŸ‰ êµ¬ë§¤ë¥¼ ì£¼ë„í•˜ë©°, ê²½ì œì  ì—¬ìœ ì™€ ì •ë¶€ ì§€ì›ì´ ì£¼ìš” ìš”ì¸.  
        - **ê°€ì¡± ì¤‘ì‹¬ ì†Œë¹„ íŒ¨í„´**ìœ¼ë¡œ ì¸í•´ ì—°ë£Œë¹„ ì ˆê°ê³¼ ì •ìˆ™ì„±ì„ ê³ ë ¤í•˜ì—¬ ì¹œí™˜ê²½ ì°¨ëŸ‰ì„ ì„ íƒ.  
        - **ì •ë¶€ ë³´ì¡°ê¸ˆ ë° ì„¸ì œ í˜œíƒ**ì´ í•´ë‹¹ ì—°ë ¹ì¸µì— ìœ ë¦¬í•˜ê²Œ ì‘ìš©í•˜ë©° êµ¬ë§¤ ê²°ì •ì— ì˜í–¥ì„ ì¤Œ.  
        - **ì „ê¸°ì°¨ ê¸°ìˆ  ë°œì „ê³¼ ì¶©ì „ ì¸í”„ë¼ í™•ì¶©**ìœ¼ë¡œ ì‹ ë¢°ë„ê°€ ìƒìŠ¹í•˜ë©° ë³´ê¸‰ì´ ê°€ì†í™”ë¨.  
        - **í™˜ê²½ ë³´í˜¸ ë° ì—°ë¹„ ì ˆê° ì¸ì‹ ì¦ê°€**ë¡œ ì¸í•´ ì¹œí™˜ê²½ì°¨ ìˆ˜ìš”ê°€ ì§€ì†ì ìœ¼ë¡œ í™•ëŒ€ë˜ëŠ” ì¶”ì„¸.  

        ì°¸ê³  ìë£Œ ì¶œì²˜ : KATECH Insight, ì¸êµ¬ ì‚¬íšŒêµ¬ì¡° ë³€í™”ì™€ êµ­ë‚´ ìë™ì°¨ ì‹œì¥ Â· ì„í˜„ì§„ ì„ ì„ì—°êµ¬ì›  
        """)

    st.markdown("---")

    category_df=df[["ì„±ë³„", "ì—°ë ¹ëŒ€", "ìµœê·¼ êµ¬ë§¤ ë‹¹ì‹œ ë‚˜ì´", "ìµœê·¼ êµ¬ë§¤ ì œí’ˆ", "ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ", "ì°¨ëŸ‰ ìœ í˜•", "ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]]
    type_df=category_df.groupby(["ì„±ë³„", "ì—°ë ¹ëŒ€", "ì°¨ëŸ‰ ìœ í˜•"])[["ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]].count().reset_index()

    size_df=df[["ì„±ë³„","ì—°ë ¹ëŒ€","ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ","ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]]
    size_df=size_df.groupby(["ì„±ë³„","ì—°ë ¹ëŒ€","ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ"])[["ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]].count().reset_index()

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„ ----
        st.subheader("ë‚¨ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„")
        st.write("ë‚¨ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        type_man=type_df[type_df["ì„±ë³„"]=="ë‚¨"]

        df_pivot = type_man.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ìœ í˜•', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig1, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• (ë‚¨)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig1)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**
        """)
    with col2:
        ## ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„ ----
        st.subheader("ë‚¨ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„")
        st.write("ë‚¨ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆë¥¼ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        size_man=size_df[size_df["ì„±ë³„"]=="ë‚¨"]

        df_pivot = size_man.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig1, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ (ë‚¨)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig1)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**
        """)

    st.markdown("---")

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        ## ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„ ----
        st.subheader("ì—¬ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„")
        st.write("ì—¬ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")
        
        type_woman=type_df[type_df["ì„±ë³„"]=="ì—¬"]

        df_pivot = type_woman.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ìœ í˜•', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig2, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• (ì—¬)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig2)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**
        """)
    with col2:
        ## ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„ ----
        st.subheader("ì—¬ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„")
        st.write("ì—¬ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆë¥¼ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        size_woman=size_df[size_df["ì„±ë³„"]=="ì—¬"]

        df_pivot = size_woman.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig1, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ (ì—¬)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig1)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**
        """)

    # ---- ì „ì²´ ìš”ì•½ ----
    # st.subheader("ê²°ë¡  ë° ìš”ì•½")
    # st.write("""
    # - íŠ¹ì • ì—°ë ¹ëŒ€ì—ì„œ ê³ ê° ìˆ˜ê°€ ì§‘ì¤‘ë˜ëŠ” ê²½í–¥ì´ ë³´ì¸ë‹¤.  
    # - êµ¬ë§¤ ìœ í˜•ë³„ë¡œ ì„ í˜¸ë„ê°€ ë‹¤ë¥´ê²Œ ë‚˜íƒ€ë‚˜ë©°, ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§ˆì¼€íŒ… ì „ëµì„ ì„¸ìš¸ ìˆ˜ ìˆë‹¤.  
    # - ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ì„ ë¶„ì„í•˜ì—¬ íƒ€ê²Ÿ ë§ˆì¼€íŒ…ì— í™œìš© ê°€ëŠ¥í•˜ë‹¤.  
    # - ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ êµ¬ë§¤ ë¹„ìœ¨ì´ ìƒìŠ¹í–ˆìœ¼ë©°, ì¹œí™˜ê²½ ì°¨ëŸ‰ì— ëŒ€í•œ ì„ í˜¸ë„ê°€ ì¦ê°€í•˜ê³  ìˆë‹¤.  
    # """)





st.markdown("---")




with tab2 :
    # íŒë§¤ ë°ì´í„° ë¶„ì„ ì„¹ì…˜
    st.header("íŒë§¤ ë°ì´í„° ë¶„ì„")
    st.write("íŒë§¤ ë°ì´í„° ê¸°ë°˜ì˜ ë¶„ì„ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.")

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„ ----
        st.subheader("êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„")
        st.write("ê³ ê°ë“¤ì´ ì„ í˜¸í•˜ëŠ” êµ¬ë§¤ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        fig, ax = plt.subplots(figsize=(8, 5))
        df["ì„ í˜¸ ê±°ë˜ ë°©ì‹"].value_counts().plot(kind="bar", color=["skyblue", "salmon", "lightgreen"], ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("êµ¬ë§¤ ìœ í˜•")
        ax.set_ylabel("ê³ ê° ìˆ˜")
        st.pyplot(fig)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
        - ëŒ€ë‹¤ìˆ˜ ê³ ê°ì´ ì˜¨ë¼ì¸ ë° ëŒ€ë¦¬ì ì„ í†µí•œ êµ¬ë§¤ë¥¼ ì„ í˜¸  
        - ì˜¨ë¼ì¸ í”„ë¡œëª¨ì…˜ ê°•í™” ë° ëŒ€ë¦¬ì ë³„ íŠ¹í™” í˜œíƒ ì œê³µ í•„ìš”  
        - ì˜¤í”„ë¼ì¸ ê³ ê° ëŒ€ìƒ, ì¶”ê°€ì ì¸ ì„œë¹„ìŠ¤ íŒ¨í‚¤ì§€ ì œê³µ ê°€ëŠ¥
        """)
    with col2:
        pass

    # ---- êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„ ----
    st.subheader("êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„")
    st.write("ê³ ê°ë“¤ì´ ì„ í˜¸í•˜ëŠ” êµ¬ë§¤ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

    fig, ax = plt.subplots(figsize=(8, 5))
    df["ì„ í˜¸ ê±°ë˜ ë°©ì‹"].value_counts().plot(kind="bar", color=["skyblue", "salmon", "lightgreen"], ax=ax)
    ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
    ax.set_xlabel("êµ¬ë§¤ ìœ í˜•")
    ax.set_ylabel("ê³ ê° ìˆ˜")
    st.pyplot(fig)

    st.write("""
    **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
    - ëŒ€ë‹¤ìˆ˜ ê³ ê°ì´ ì˜¨ë¼ì¸ ë° ëŒ€ë¦¬ì ì„ í†µí•œ êµ¬ë§¤ë¥¼ ì„ í˜¸  
    - ì˜¨ë¼ì¸ í”„ë¡œëª¨ì…˜ ê°•í™” ë° ëŒ€ë¦¬ì ë³„ íŠ¹í™” í˜œíƒ ì œê³µ í•„ìš”  
    - ì˜¤í”„ë¼ì¸ ê³ ê° ëŒ€ìƒ, ì¶”ê°€ì ì¸ ì„œë¹„ìŠ¤ íŒ¨í‚¤ì§€ ì œê³µ ê°€ëŠ¥
    """)

    # ---- ì „ê¸°ì°¨ vs. ë‚´ì—°ê¸°ê´€ì°¨ êµ¬ë§¤ íŠ¸ë Œë“œ ë¹„êµ ----
    st.subheader("ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ êµ¬ë§¤ ì¦ê°€ìœ¨ vs. ë‚´ì—°ê¸°ê´€ ì°¨ëŸ‰ êµ¬ë§¤ìœ¨ ë¹„êµ")
    st.write("ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ì™€ ë‚´ì—°ê¸°ê´€ ì°¨ëŸ‰ì˜ êµ¬ë§¤ íŠ¸ë Œë“œë¥¼ ë¹„êµí–ˆìŠµë‹ˆë‹¤.")

    recent_years = df[df["ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ"] >= (df["ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ"].max() - pd.DateOffset(years=3))]
    ev_vs_ice = recent_years["ì—°ë£Œ êµ¬ë¶„"].value_counts()
    fig, ax = plt.subplots(figsize=(8, 5))
    ev_vs_ice.plot(kind="bar", color=["green", "gray"], ax=ax)
    ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
    ax.set_xlabel("ì°¨ëŸ‰ ìœ í˜•")
    ax.set_ylabel("êµ¬ë§¤ ìˆ˜")
    ax.set_title("ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ vs. ë‚´ì—°ê¸°ê´€ì°¨ êµ¬ë§¤ ë¹„êµ")
    st.pyplot(fig)

    st.write("""
    **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
    - ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ íŒë§¤ëŸ‰ì´ ê¾¸ì¤€íˆ ì¦ê°€   
    - ë‚´ì—°ê¸°ê´€ì°¨ë³´ë‹¤ ì „ê¸°ì°¨ êµ¬ë§¤ ë¹„ìœ¨ì´ ë†’ì•„ì§€ëŠ” ì¶”ì„¸ 
    - ì „ê¸°ì°¨ ê´€ë ¨ ê¸ˆìœµ í˜œíƒ ë° ì¶©ì „ì†Œ ì¸í”„ë¼ í™•ì¥ í•„ìš”
    """)

    st.warning("ê·¼ê±°ê°€ ë¶€ì¡±í•œ ë¶„ì„, ë‹¤ì‹œ í™•ì¸ í•„ìš”")