import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
import seaborn as sb
import os

# í˜„ì¬ íŒŒì¼ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì ˆëŒ€ ê²½ë¡œ ì„¤ì •
base_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), "..", "fonts"))
font_path = os.path.join(base_dir, "NanumGothic.ttf")  # ë˜ëŠ” .otf ì‚¬ìš© ê°€ëŠ¥

# ë””ë²„ê¹…: í°íŠ¸ ê²½ë¡œ í™•ì¸
print("í°íŠ¸ ê²½ë¡œ:", font_path)
print("íŒŒì¼ ì¡´ì¬ ì—¬ë¶€:", os.path.exists(font_path))

# í°íŠ¸ ì„¤ì •
if os.path.exists(font_path):
    font_prop = fm.FontProperties(fname=font_path)
    plt.rcParams['font.family'] = font_prop.get_name()
    plt.rcParams['axes.unicode_minus'] = False  # ë§ˆì´ë„ˆìŠ¤ ê¸°í˜¸ ê¹¨ì§ ë°©ì§€
else:
    print("í°íŠ¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

# ë°ì´í„° ë¡œë“œ
df = pd.read_csv("data/ê³ ê°db_ì „ì²˜ë¦¬.csv")

# Streamlit í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ê³ ê° ë¶„ì„ ëŒ€ì‹œë³´ë“œ", layout="wide")

# í˜ì´ì§€ ì œëª©
st.title("ë¶„ì„ ëŒ€ì‹œë³´ë“œ")

tab1, tab2 = st.tabs(["##ê³ ê° ë°ì´í„° ë¶„ì„", "íŒë§¤ ë°ì´í„° ë¶„ì„"])

with tab1 :
    # ê³ ê° ë°ì´í„° ë¶„ì„ ì„¹ì…˜

    st.write("ê³ ê° ë°ì´í„° ê¸°ë°˜ì˜ ë¶„ì„ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.")

    # ë¶„ì„ ê°œìš” ì„¹ì…˜
    with st.expander("ë¶„ì„ ê°œìš” ë³´ê¸°"):
        st.write("""
        **í”„ë¡œì íŠ¸ ëª©í‘œ**  
        - ê³ ê°ì˜ ì—°ë ¹ëŒ€, ê±°ì£¼ ì§€ì—­, êµ¬ë§¤ ì„ í˜¸ë„ë¥¼ ë¶„ì„í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ ì œê³µ  
        - ì „ê¸°ì°¨ ë° ë‚´ì—°ê¸°ê´€ì°¨ì˜ íŠ¸ë Œë“œ ë³€í™” í™•ì¸  
        - ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ë§ˆì¼€íŒ… ì „ëµ ìµœì í™”  

        **ì‚¬ìš©ëœ ë°ì´í„°**  
        - ê³ ê° ì—°ë ¹ëŒ€, ê±°ì£¼ ì§€ì—­, ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸, ì—°ë£Œ ìœ í˜•, ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ ë“±  
        """)

    st.text("")

    # ì—°ë ¹ëŒ€ ì •ë ¬ì„ ìœ„í•œ ìˆœì„œ ì§€ì •
    age_order = [
        "20ëŒ€ ì´ˆë°˜", "20ëŒ€ ì¤‘ë°˜", "20ëŒ€ í›„ë°˜",
        "30ëŒ€ ì´ˆë°˜", "30ëŒ€ ì¤‘ë°˜", "30ëŒ€ í›„ë°˜",
        "40ëŒ€ ì´ˆë°˜", "40ëŒ€ ì¤‘ë°˜", "40ëŒ€ í›„ë°˜",
        "50ëŒ€ ì´ˆë°˜", "50ëŒ€ ì¤‘ë°˜", "50ëŒ€ í›„ë°˜",
        "60ëŒ€ ì´ˆë°˜", "60ëŒ€ ì¤‘ë°˜", "60ëŒ€ í›„ë°˜",
        "70ëŒ€ ì´ˆë°˜"
    ]

    col1, col2 = st.columns([0.9, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- ì—°ë ¹ëŒ€ë³„ ê³ ê° ë¶„í¬ ----
        st.subheader("ì—°ë ¹ëŒ€ë³„ ê³ ê° ë¶„í¬")
        st.write("ê³ ê°ì˜ ì—°ë ¹ëŒ€ë³„ ë¶„í¬ë¥¼ íˆìŠ¤í† ê·¸ë¨ìœ¼ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")  

        # ì—°ë ¹ëŒ€ ì •ë ¬ í›„ ì‹œê°í™”
        df["ì—°ë ¹ëŒ€"] = pd.Categorical(df["ì—°ë ¹ëŒ€"], categories=age_order, ordered=True)
        fig1, ax = plt.subplots(figsize=(8, 5))
        sb.histplot(df.sort_values("ì—°ë ¹ëŒ€")["ì—°ë ¹ëŒ€"], kde=True, color="blue", ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("ì—°ë ¹ëŒ€")
        ax.set_ylabel("ê³ ê° ìˆ˜")
        st.pyplot(fig1)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
        - íŠ¹ì • ì—°ë ¹ëŒ€(30~40ëŒ€)ì— ê³ ê°ì´ ì§‘ì¤‘ë¨  
        - ì´ ì—°ë ¹ëŒ€ì— ë§ì¶˜ íƒ€ê²Ÿ ë§ˆì¼€íŒ… ì „ëµì´ íš¨ê³¼ì ì¼ ê°€ëŠ¥ì„± ë†’ìŒ  
        - ê°€ì¡± ë‹¨ìœ„ ì°¨ëŸ‰ í”„ë¡œëª¨ì…˜, ì¥ê¸° ë ŒíŠ¸ í˜œíƒ ì œê³µ ê°€ëŠ¥
        """)
    with col2:
        # ---- ì§€ì—­ë³„ ê³ ê° ìˆ˜ ë¶„ì„ ----
        st.subheader("ì§€ì—­ë³„ ê³ ê° ë¶„í¬")
        st.write("ê³ ê°ë“¤ì´ ê±°ì£¼í•˜ëŠ” ì§€ì—­ë³„ ë¶„í¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.") 

        fig2, ax = plt.subplots(figsize=(8, 5))
        df["ê±°ì£¼ ì§€ì—­"].value_counts().plot(kind="barh", color="orange", ax=ax)
        ax.set_xlabel("ì§€ì—­")
        ax.set_ylabel("ê³ ê° ìˆ˜") 
        st.pyplot(fig2)

        st.write("""
        **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
        - íŠ¹ì • ì§€ì—­(ì„œìš¸, ê²½ê¸°)ì— ê³ ê°ì´ ì§‘ì¤‘ë¨  
        - í•´ë‹¹ ì§€ì—­ì—ì„œ ì°¨ëŸ‰ ì „ì‹œíšŒ ë° ì‹œìŠ¹ ì´ë²¤íŠ¸ ê¸°íš ê°€ëŠ¥  
        - ì§€ë°© ê±°ì£¼ ê³ ê° ëŒ€ìƒ, ë¹„ëŒ€ë©´ ì„œë¹„ìŠ¤(ë¼ì´ë¸Œ ìƒë‹´, ì˜¨ë¼ì¸ ê³„ì•½ ë“±) í™•ëŒ€ í•„ìš”
        """)

    st.markdown("---")
    
    # ì—°ë ¹ëŒ€ë³„ ìƒìœ„ 3ê°œ ì°¨ëŸ‰ ëª¨ë¸ ì„ ì •
    top_models = df.groupby(["ì—°ë ¹ëŒ€", "ìµœê·¼ êµ¬ë§¤ ì œí’ˆ"]).size().reset_index(name="count")
    top_models = top_models.sort_values(["ì—°ë ¹ëŒ€", "count"], ascending=[True, False])
    top_models = top_models.groupby("ì—°ë ¹ëŒ€").head(3)  # ê° ì—°ë ¹ëŒ€ì—ì„œ ìƒìœ„ 3ê°œ ëª¨ë¸ ì„ íƒ

    eco_friendly_types = ["ì „ê¸°", "ìˆ˜ì†Œ", "í•˜ì´ë¸Œë¦¬ë“œ", "í”ŒëŸ¬ê·¸ì¸í•˜ì´ë¸Œë¦¬ë“œ"]
    ev_preference = df[df["ì—°ë£Œ êµ¬ë¶„"].isin(eco_friendly_types)].groupby("ì—°ë ¹ëŒ€")["ì—°ë£Œ êµ¬ë¶„"].count()

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- ì°¨ëŸ‰ ë¸Œëœë“œ & ëª¨ë¸ë³„ ì„ í˜¸ë„ ë¶„ì„ ----
        st.subheader("ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ ë¶„ì„")
        st.write("ì—°ë ¹ëŒ€ë³„ë¡œ ì„ í˜¸í•˜ëŠ” ìƒìœ„ 3ê°œ ì°¨ëŸ‰ ëª¨ë¸ì„ ì„ ì •í•˜ì—¬ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤.")

        fig1, ax = plt.subplots(figsize=(10, 6))
        sb.barplot(data=top_models, x="ì—°ë ¹ëŒ€", y="count", hue="ìµœê·¼ êµ¬ë§¤ ì œí’ˆ", palette="coolwarm", ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("ì—°ë ¹ëŒ€")
        ax.set_ylabel("ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ ìˆ˜")
        ax.set_title("ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ (ìƒìœ„ 3ê°œ)")
        st.pyplot(fig1)

        st.text("")
        
        st.markdown("""
        **ğŸ“Š ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ëª¨ë¸ ë¶„ì„**  
        - **20~30ëŒ€ ì´ˆë°˜**: ì†Œí˜• ì„¸ë‹¨ ë° ìŠ¤í¬ì¸ ì¹´ ì„ í˜¸ â†’ ê²½ì œì„± ë° ê°œì„± ì¤‘ì‹œ.  
        - **30ëŒ€ í›„ë°˜~40ëŒ€ í›„ë°˜**: ì¤‘í˜• ì„¸ë‹¨ ë° SUV ì„ í˜¸ â†’ íŒ¨ë°€ë¦¬ì¹´ ë° ì‹¤ìš©ì„± ê°•ì¡°.  
        - **50ëŒ€ í›„ë°˜ ì´ìƒ**: ëŒ€í˜• ì„¸ë‹¨ ë° í”„ë¦¬ë¯¸ì—„ ì°¨ëŸ‰ ì„ í˜¸ â†’ ìŠ¹ì°¨ê° ë° ë¸Œëœë“œ ê°€ì¹˜ ì¤‘ì‹œ.  
        - **ì¹œí™˜ê²½ ì°¨ëŸ‰ ì¦ê°€**: 30~50ëŒ€ ê³ ê°ì¸µì—ì„œ ì „ê¸°ì°¨ ë° í•˜ì´ë¸Œë¦¬ë“œ ì°¨ëŸ‰ ì„ í˜¸ë„ ìƒìŠ¹.  
        - **ë§ˆì¼€íŒ… í™œìš©**: ì—°ë ¹ë³„ ì„ í˜¸ ëª¨ë¸ì„ ë°˜ì˜í•œ ë§ì¶¤í˜• ê¸ˆìœµ í˜œíƒ ë° ì°¨ëŸ‰ í”„ë¡œëª¨ì…˜ ì „ëµ í•„ìš”.  

        ì°¸ê³  ìë£Œ ì¶œì²˜: KATECH Insight, êµ­í† êµí†µë¶€ ìë™ì°¨ ë“±ë¡ í†µê³„, í˜„ëŒ€ì°¨Â·ê¸°ì•„ ì—°êµ¬ ë³´ê³ ì„œ  
        """)

    with col2:
        # ---- ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ ì„ í˜¸ë„ ë¶„ì„ ----
        st.subheader("ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ ì„ í˜¸ë„")
        st.write("ê° ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰(ì „ê¸°, ìˆ˜ì†Œ, í•˜ì´ë¸Œë¦¬ë“œ, í”ŒëŸ¬ê·¸ì¸í•˜ì´ë¸Œë¦¬ë“œ)ì˜ ì„ í˜¸ë„ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.")   

        fig2, ax = plt.subplots(figsize=(8, 5))
        ev_preference.plot(kind="bar", color="lightgreen", ax=ax)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_xlabel("ì—°ë ¹ëŒ€")
        ax.set_ylabel("ì¹œí™˜ê²½ ì°¨ëŸ‰ êµ¬ë§¤ ìˆ˜")
        ax.set_title("ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ êµ¬ë§¤ ì„ í˜¸ë„")
        st.pyplot(fig2)
    
        st.markdown("""
        **ğŸ“Š ì—°ë ¹ëŒ€ë³„ ì¹œí™˜ê²½ ì°¨ëŸ‰ ì„ í˜¸ë„ ë¶„ì„**  
        - **30~50ëŒ€ ê³ ê°ì¸µ**: ì „ê¸°ì°¨ ë° í•˜ì´ë¸Œë¦¬ë“œ ì°¨ëŸ‰ ì„ í˜¸ë„ ë†’ìŒ â†’ ì—°ë£Œë¹„ ì ˆê° ë° í™˜ê²½ ë³´í˜¸ ì¸ì‹ ì¦ê°€.  
        - **ì¹œí™˜ê²½ ì°¨ëŸ‰ ì¸í”„ë¼ í™•ëŒ€**: ì¶©ì „ì†Œ ë° ìœ ì§€ë³´ìˆ˜ ì§€ì› ì •ì±… ê°•í™” í•„ìš”.  
        - **ì •ë¶€ ì§€ì› í™œìš©**: ì¹œí™˜ê²½ ì°¨ëŸ‰ ë³´ì¡°ê¸ˆ ë° ì„¸ê¸ˆ ê°ë©´ í˜œíƒì„ ê°•ì¡°í•œ ë§ˆì¼€íŒ… í•„ìš”.  
        - **ë§ì¶¤í˜• ì°¨ëŸ‰ ì˜µì…˜ ì œê³µ**: ì—°ë ¹ëŒ€ë³„ ì£¼í–‰ íŒ¨í„´ì„ ê³ ë ¤í•œ ì¹œí™˜ê²½ ì°¨ëŸ‰ ì¶”ì²œ ì „ëµ í•„ìš”.  

        ì°¸ê³  ìë£Œ ì¶œì²˜: KATECH Insight, êµ­í† êµí†µë¶€ ìë™ì°¨ ë“±ë¡ í†µê³„, í˜„ëŒ€ì°¨Â·ê¸°ì•„ ì—°êµ¬ ë³´ê³ ì„œ  
        """)

    st.markdown("---")

    category_df=df[["ì„±ë³„", "ì—°ë ¹ëŒ€", "ìµœê·¼ êµ¬ë§¤ ë‹¹ì‹œ ë‚˜ì´", "ìµœê·¼ êµ¬ë§¤ ì œí’ˆ", "ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ", "ì°¨ëŸ‰ ìœ í˜•", "ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]]
    type_df=category_df.groupby(["ì„±ë³„", "ì—°ë ¹ëŒ€", "ì°¨ëŸ‰ ìœ í˜•"])[["ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]].count().reset_index()

    size_df=df[["ì„±ë³„","ì—°ë ¹ëŒ€","ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ","ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]]
    size_df=size_df.groupby(["ì„±ë³„","ì—°ë ¹ëŒ€","ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ"])[["ìµœê·¼ ê±°ë˜ ê¸ˆì•¡"]].count().reset_index()

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„ ----
        st.subheader("ë‚¨ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„")
        st.write("ë‚¨ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        type_man=type_df[type_df["ì„±ë³„"]=="ë‚¨"]

        df_pivot = type_man.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ìœ í˜•', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig1, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• (ë‚¨)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig1)

        st.markdown("""
        **ğŸ“Š ë‚¨ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„**  
        - **20~30ëŒ€ ì´ˆë°˜**: ì¤€ì¤‘í˜• & ì¤‘í˜• ì°¨ëŸ‰ ì„ í˜¸ â†’ ê²½ì œì„± ë° ì‹¤ìš©ì„±ì´ ì¤‘ìš”.  
        - **30ëŒ€ í›„ë°˜~50ëŒ€ ì´ˆë°˜**: ì¤‘í˜• & ëŒ€í˜• ì°¨ëŸ‰ ì„ í˜¸ â†’ ê°€ì¡± ë° ì—…ë¬´ìš© ìˆ˜ìš” ì¦ê°€.  
        - **50ëŒ€ í›„ë°˜ ì´ìƒ**: í”„ë¦¬ë¯¸ì—„ & ëŒ€í˜• ì°¨ëŸ‰ ì„ í˜¸ â†’ ìŠ¹ì°¨ê° ë° ë¸Œëœë“œ ê°€ì¹˜ ì¤‘ì‹œ.  
        - **ì¤‘í˜• ì°¨ëŸ‰ì˜ ì§€ì†ì ì¸ ì¸ê¸°**: ì‹¤ìš©ì„±ê³¼ ê°€ê²© ëŒ€ë¹„ ì„±ëŠ¥ì´ ê· í˜•ì„ ì´ë£¨ëŠ” ì„ íƒì§€.  
        - **ë§ˆì¼€íŒ… í™œìš©**: ì—°ë ¹ë³„ ë‹ˆì¦ˆë¥¼ ë°˜ì˜í•œ ë§ì¶¤í˜• ì°¨ëŸ‰ ì¶”ì²œ ë° í”„ë¡œëª¨ì…˜ ì „ëµ í•„ìš”.  

        ì°¸ê³  ìë£Œ ì¶œì²˜: KATECH Insight, êµ­í† êµí†µë¶€ ìë™ì°¨ ë“±ë¡ í†µê³„, í˜„ëŒ€ì°¨Â·ê¸°ì•„ ì—°êµ¬ ë³´ê³ ì„œ  
        """)


    with col2:
        ## ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„ ----
        st.subheader("ë‚¨ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„")
        st.write("ë‚¨ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆë¥¼ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        size_man=size_df[size_df["ì„±ë³„"]=="ë‚¨"]

        df_pivot = size_man.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig1, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ (ë‚¨)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig1)

        st.markdown("""
        **ğŸ“Š ë‚¨ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„**  
        - **20~30ëŒ€ ì´ˆë°˜**: ì„¸ë‹¨ ì„ í˜¸ë„ ë†’ìŒ â†’ ê²½ì œì„± ë° ìœ ì§€ë¹„ ê³ ë ¤.  
        - **30ëŒ€ í›„ë°˜~50ëŒ€ ì´ˆë°˜**: SUV ì„ í˜¸ë„ ì¦ê°€ â†’ ê°€ì¡± ë° ë ˆì € í™œë™ ìˆ˜ìš” ë°˜ì˜.  
        - **50ëŒ€ í›„ë°˜~60ëŒ€ ì´í›„**: SUV ì„ í˜¸ ìœ ì§€ â†’ ìš´ì „ í¸ì˜ì„±ê³¼ ì•ˆì •ì„± ì¤‘ìš”.  
        - **SUV ì¸ê¸° ìš”ì¸**: ê³µê°„ í™œìš©ì„±, ë†’ì€ ì‹œì•¼ í™•ë³´, í•˜ì´ë¸Œë¦¬ë“œÂ·ì „ê¸°ì°¨ ì˜µì…˜ ì¦ê°€.  
        - **ë§ˆì¼€íŒ… ì „ëµ**: ì—°ë ¹ëŒ€ë³„ ë‹ˆì¦ˆ ë°˜ì˜í•œ ë§ì¶¤í˜• í”„ë¡œëª¨ì…˜ ë° ì°¨ëŸ‰ ì¶”ì²œ í•„ìš”.  

        ì°¸ê³  ìë£Œ ì¶œì²˜: KATECH Insight, êµ­í† êµí†µë¶€ ìë™ì°¨ ë“±ë¡ í†µê³„, í˜„ëŒ€ì°¨Â·ê¸°ì•„ ì—°êµ¬ ë³´ê³ ì„œ  
        """)



    st.markdown("---")

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        ## ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„ ----
        st.subheader("ì—¬ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„")
        st.write("ì—¬ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")
        
        type_woman=type_df[type_df["ì„±ë³„"]=="ì—¬"]

        df_pivot = type_woman.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ìœ í˜•', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig2, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• (ì—¬)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig2)

        st.markdown("""
        **ğŸ“Š ì—¬ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ìœ í˜• ë¶„ì„**  
        - **20~30ëŒ€ ì´ˆë°˜**: SUV ì„ í˜¸ë„ ë†’ìŒ â†’ ë†’ì€ ì‹œì•¼ í™•ë³´ ë° ì£¼í–‰ ì•ˆì „ì„± ê³ ë ¤.  
        - **30ëŒ€ í›„ë°˜~50ëŒ€ ì´ˆë°˜**: ì„¸ë‹¨ ì„ í˜¸ë„ ì¦ê°€ â†’ ê²½ì œì„±ê³¼ ìœ ì§€ë¹„ ì ˆê° ìš”ì¸ì´ ì‘ìš©.  
        - **50ëŒ€ í›„ë°˜~60ëŒ€ ì´í›„**: ì„¸ë‹¨ ìœ ì§€, SUV ìˆ˜ìš” ì¦ê°€ â†’ ì¥ê±°ë¦¬ ìš´ì „ ë° í¸ì˜ì„± ì¤‘ì‹œ.  
        - **SUV ì¸ê¸° ìš”ì¸**: ë ˆì €Â·íŒ¨ë°€ë¦¬ì¹´ ìˆ˜ìš” ì¦ê°€, ì „ê¸°ì°¨Â·í•˜ì´ë¸Œë¦¬ë“œ ì„ íƒ í™•ëŒ€.  
        - **ë§ˆì¼€íŒ… ì „ëµ**: ì—°ë ¹ë³„ ë¼ì´í”„ìŠ¤íƒ€ì¼ ë§ì¶¤í˜• ì°¨ëŸ‰ ì¶”ì²œ ë° í”„ë¡œëª¨ì…˜ ì œê³µ.  

        ì°¸ê³  ìë£Œ ì¶œì²˜: KATECH Insight, êµ­í† êµí†µë¶€ ìë™ì°¨ ë“±ë¡ í†µê³„, í˜„ëŒ€ì°¨Â·ê¸°ì•„ ì—°êµ¬ ë³´ê³ ì„œ  
        """)

    with col2:
        ## ---- ì„±ë³„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„ ----
        st.subheader("ì—¬ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„")
        st.write("ì—¬ì„± ê³ ê°ë“¤ì˜ ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆë¥¼ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        size_woman=size_df[size_df["ì„±ë³„"]=="ì—¬"]

        df_pivot = size_woman.pivot_table(index='ì—°ë ¹ëŒ€', columns='ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ', values='ìµœê·¼ ê±°ë˜ ê¸ˆì•¡', aggfunc='sum', fill_value=0)

        colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

        fig1, ax = plt.subplots(figsize=(12, 8))
        df_pivot.plot(kind='bar', ax=ax, color=colors)
        ax.set_title('ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ (ì—¬)', fontsize=16)
        ax.set_xlabel('ì—°ë ¹ëŒ€', fontsize=12)
        ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
        ax.set_ylabel('íŒë§¤ëŸ‰', fontsize=12)
        plt.tight_layout()
        st.pyplot(fig1)

        st.markdown("""
        **ğŸ“Š ì—¬ì„± ê³ ê° ì—°ë ¹ëŒ€ë³„ ì„ í˜¸ ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ ë¶„ì„**  
        - **20~30ëŒ€ ì´ˆë°˜**: ì¤€ì¤‘í˜• ì°¨ëŸ‰ ì„ í˜¸ â†’ ê²½ì œì„± ë° ë„ì‹¬ ìš´ì „ í¸ë¦¬ì„± ì¤‘ì‹œ.  
        - **30ëŒ€ í›„ë°˜~50ëŒ€ ì´ˆë°˜**: ì¤‘í˜• ì°¨ëŸ‰ ì„ í˜¸ ì¦ê°€ â†’ ê°€ì¡± ì´ë™ ìˆ˜ìš” ì¦ê°€ ë°˜ì˜.  
        - **50ëŒ€ í›„ë°˜~60ëŒ€ ì´í›„**: ì¤‘í˜• ë° ì¤€ì¤‘í˜• ìœ ì§€, ì¼ë¶€ í”„ë¦¬ë¯¸ì—„ ì°¨ëŸ‰ ì„ íƒ ì¦ê°€.  
        - **ì„ í˜¸ ìš”ì¸**: ê²½ì œì„±, ìœ ì§€ë¹„ ì ˆê°, ì£¼ì°¨ ë° ë„ì‹¬ ìš´ì „ í¸ì˜ì„±.  
        - **ë§ˆì¼€íŒ… ì „ëµ**: ì—°ë ¹ë³„ ì°¨ëŸ‰ íŠ¹ì„±ì„ ê³ ë ¤í•œ ë§ì¶¤í˜• í”„ë¡œëª¨ì…˜ ë° í˜œíƒ ì œê³µ.  

        ì°¸ê³  ìë£Œ ì¶œì²˜: KATECH Insight, êµ­í† êµí†µë¶€ ìë™ì°¨ ë“±ë¡ í†µê³„, í˜„ëŒ€ì°¨Â·ê¸°ì•„ ì—°êµ¬ ë³´ê³ ì„œ  
        """)

    st.markdown("---")

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        pass



st.markdown("---")




with tab2 :
    # íŒë§¤ ë°ì´í„° ë¶„ì„ ì„¹ì…˜
    st.header("íŒë§¤ ë°ì´í„° ë¶„ì„")
    st.write("íŒë§¤ ë°ì´í„° ê¸°ë°˜ì˜ ë¶„ì„ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.")

    col1, col2 = st.columns([1, 1])  # ì¢Œìš° ì—¬ë°± ì¶”ê°€
    with col1:
        # ---- êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„ ----
        st.subheader("ì‹œê¸° ë° ì—°ë£Œ êµ¬ë¶„ë³„ íŒë§¤ ëŒ€ìˆ˜")
        st.write("ê³ ê°ë“¤ì´ ì„ í˜¸í•˜ëŠ” ì—°ë£Œ êµ¬ë¶„ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

        date_order = ["2023 1ë¶„ê¸°", "2023 2ë¶„ê¸°", "2023 3ë¶„ê¸°", "2023 4ë¶„ê¸°", "2024 1ë¶„ê¸°", "2024 2ë¶„ê¸°", "2024 3ë¶„ê¸°", "2024 4ë¶„ê¸°", "2025 1ë¶„ê¸°"]

        df["ìµœê·¼ êµ¬ë§¤ ì‹œì "] = pd.Categorical(df["ìµœê·¼ êµ¬ë§¤ ì‹œì "], categories=date_order, ordered=True)

        # êµ¬ë§¤ ê¸°ì¤€ ì‹œì ë³„ ê° ì—°ë£Œ êµ¬ë¶„ì˜ ê°œìˆ˜ ì‹œê°í™”
        fig1, ax = plt.subplots(figsize=(12, 8))

        sb.lineplot(x="ìµœê·¼ êµ¬ë§¤ ì‹œì ", y="ì—°ë²ˆ", hue="ì—°ë£Œ êµ¬ë¶„", data=df, marker="o", palette="Set2", lw=2, ax=ax)
        ax.set_title("êµ¬ë§¤ ê¸°ì¤€ ì‹œì ë³„ ì—°ë£Œ êµ¬ë¶„ë³„ íŒë§¤ ëŒ€ìˆ˜")
        ax.set_xlabel("ìµœê·¼ êµ¬ë§¤ ì‹œì ")
        ax.set_ylabel("íŒë§¤ ëŒ€ìˆ˜")
        ax.set_xticks(range(len(date_order)))
        ax.set_xticklabels(date_order, rotation=30)
        ax.grid(axis="y", linestyle="--")
        ax.legend(title="ì—°ë£Œ êµ¬ë¶„", loc="upper left")
        st.pyplot(fig1)

        st.write("""
        **ë¶„ì„ ê²°ê³¼**
        """)
    with col2:
        pass



    # ---- êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„ ----
    st.subheader("êµ¬ë§¤ ìœ í˜•ë³„ ì„ í˜¸ë„")
    st.write("ê³ ê°ë“¤ì´ ì„ í˜¸í•˜ëŠ” êµ¬ë§¤ ìœ í˜•ì„ ë¶„ì„í•˜ì—¬ ê·¸ë˜í”„ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.")

    fig, ax = plt.subplots(figsize=(8, 5))
    df["ì„ í˜¸ ê±°ë˜ ë°©ì‹"].value_counts().plot(kind="bar", color=["skyblue", "salmon", "lightgreen"], ax=ax)
    ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
    ax.set_xlabel("êµ¬ë§¤ ìœ í˜•")
    ax.set_ylabel("ê³ ê° ìˆ˜")
    st.pyplot(fig)

    st.write("""
    **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
    - ëŒ€ë‹¤ìˆ˜ ê³ ê°ì´ ì˜¨ë¼ì¸ ë° ëŒ€ë¦¬ì ì„ í†µí•œ êµ¬ë§¤ë¥¼ ì„ í˜¸  
    - ì˜¨ë¼ì¸ í”„ë¡œëª¨ì…˜ ê°•í™” ë° ëŒ€ë¦¬ì ë³„ íŠ¹í™” í˜œíƒ ì œê³µ í•„ìš”  
    - ì˜¤í”„ë¼ì¸ ê³ ê° ëŒ€ìƒ, ì¶”ê°€ì ì¸ ì„œë¹„ìŠ¤ íŒ¨í‚¤ì§€ ì œê³µ ê°€ëŠ¥
    """)

    # # ---- ì „ê¸°ì°¨ vs. ë‚´ì—°ê¸°ê´€ì°¨ êµ¬ë§¤ íŠ¸ë Œë“œ ë¹„êµ ----
    # st.subheader("ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ êµ¬ë§¤ ì¦ê°€ìœ¨ vs. ë‚´ì—°ê¸°ê´€ ì°¨ëŸ‰ êµ¬ë§¤ìœ¨ ë¹„êµ")
    # st.write("ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ì™€ ë‚´ì—°ê¸°ê´€ ì°¨ëŸ‰ì˜ êµ¬ë§¤ íŠ¸ë Œë“œë¥¼ ë¹„êµí–ˆìŠµë‹ˆë‹¤.")

    # recent_years = df[df["ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ"] >= (df["ìµœê·¼ êµ¬ë§¤ ë‚ ì§œ"].max() - pd.DateOffset(years=3))]
    # ev_vs_ice = recent_years["ì—°ë£Œ êµ¬ë¶„"].value_counts()
    # fig, ax = plt.subplots(figsize=(8, 5))
    # ev_vs_ice.plot(kind="bar", color=["green", "gray"], ax=ax)
    # ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha="right")
    # ax.set_xlabel("ì°¨ëŸ‰ ìœ í˜•")
    # ax.set_ylabel("êµ¬ë§¤ ìˆ˜")
    # ax.set_title("ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ vs. ë‚´ì—°ê¸°ê´€ì°¨ êµ¬ë§¤ ë¹„êµ")
    # st.pyplot(fig)

    # st.write("""
    # **ë¶„ì„ ê²°ê³¼ ë° í™œìš© ë°©ì•ˆ**  
    # - ìµœê·¼ 3ë…„ê°„ ì „ê¸°ì°¨ íŒë§¤ëŸ‰ì´ ê¾¸ì¤€íˆ ì¦ê°€   
    # - ë‚´ì—°ê¸°ê´€ì°¨ë³´ë‹¤ ì „ê¸°ì°¨ êµ¬ë§¤ ë¹„ìœ¨ì´ ë†’ì•„ì§€ëŠ” ì¶”ì„¸ 
    # - ì „ê¸°ì°¨ ê´€ë ¨ ê¸ˆìœµ í˜œíƒ ë° ì¶©ì „ì†Œ ì¸í”„ë¼ í™•ì¥ í•„ìš”
    # """)

    st.warning("ê·¼ê±°ê°€ ë¶€ì¡±í•œ ë¶„ì„, ë‹¤ì‹œ í™•ì¸ í•„ìš”")


    # ---- ì—°ë ¹ëŒ€ ë° ì„±ë³„ ì°¨ëŸ‰ êµ¬ë§¤ ëŒ€ìˆ˜ ----
    st.subheader("ì§€ì—­ë³„ ê³ ê° ë¶„í¬")
    st.write("ê³ ê°ë“¤ì´ ê±°ì£¼í•˜ëŠ” ì§€ì—­ë³„ ë¶„í¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.") 

    # ì—°ë ¹ëŒ€ë³„ ê° ì„±ë³„ì´ êµ¬ë§¤í•œ ì°¨ëŸ‰ ìˆ˜ í•©ê³„
    gender_df = df.groupby(["ì„±ë³„", "ì—°ë ¹ëŒ€"])["ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ"].count().reset_index()

    df_pivot = gender_df.pivot_table(index="ì—°ë ¹ëŒ€", columns="ì„±ë³„", values="ì°¨ëŸ‰ ì‚¬ì´ì¦ˆ", fill_value=0)

    colors = sb.color_palette("Set2", n_colors=len(df_pivot.columns))

    fig1, ax = plt.subplots(figsize=(12, 8))
    df_pivot.plot.bar(ax=ax, color=colors)
    ax.set_title("ì—°ë ¹ëŒ€ë³„ ì„±ë³„ ì°¨ëŸ‰ êµ¬ë§¤ ìˆ˜", fontsize=16)
    ax.set_xlabel("ì—°ë ¹ëŒ€", fontsize=12)
    ax.set_ylabel("íŒë§¤ëŸ‰", fontsize=12)
    ax.legend(title="ì„±ë³„")
    ax.set_xticklabels(df_pivot.index, rotation=0)
    plt.tight_layout()
    st.pyplot(fig1)

    st.markdown("""
    **ğŸ“Š ë¶„ì„ ê²°ê³¼**  
    - ë‚´ìš©
    """)